---
title: Реляционная модель.
---

Нормализация.

Цель = НФБК =  Нормальная Форма Бойса-Кодда = все ФЗ следуют из утверждения &quot;ключ -&gt; все&quot;.

- .Формально, R находится в НФБК, если для каждой нетривиальной ФЗ R, например X -&gt; A, X -суперключ.
- .&quot;Нетривиальная&quot; = правосторонний атрибут не присутствует нигде в левой стороне.

Почему?

1. Гарантирует отсутствие избыточности.

2. Гарантирует отсутствие проблем модификации = изменение одного кортежа не влечет изменение остальных.

3. Гарантирует отсутствие проблем удаления = нет потерь информации при удалении кортежей.

Пример.

Drinkers (name, addr, beersLiked, manf, favoriteBeer)





name   addr   beersLiked  manf  favoriteBeer

#### Janeway    Voyager      Bud                   A.B.          WickedAle

Janeway    ????            WickedAle        Pete&#39;s         ????

Spock        Enterprise   Bud                   ????           Bud

Функциональные зависимости:

1. name -&gt; addr

2. name -&gt; favoriteBeer

3. beersLiked -&gt; manf

- .???? – избыточная информация, поскольку она может быть выведена из ФЗ.
- .Проблема модификации: Если Janeway назначить на Intrepid, не забудем ли мы изменить addr в каждом ее кортеже?
- .Проблема удаления: Если никто не предпочитает Bud, то нигде не будет храниться его manf.

Каждая из приведенных ФЗ – это нарушение НФБК:

- .Ключ = {name, beersLiked}.

- .Каждая из приведенных ФЗ имеет левую сторону, как строгое подмножество ключа.

Другой пример:

Beers (name, manf, manfAddr)

ФЗ = name -&gt; manf, manf -&gt; manfAddr

- .Ключ - name.

- .manf -&gt; manfAddr нарушает НФБК, т.к. левая сторона не связана с ключом.

Декомпозиция для приведения к НФБК.

Задача: Отношение R с ФЗ F. Предположим, что отношение R имеет нарушение НФБК  X -&gt; B.

- .Необходимо просмотреть среди ФЗ F нарушения НФБК, но не те,  которые следуют из F. Почему?

1. Вычислить X+.

- .Не может содержать все атрибуты - почему?

2. Разбить R на X+ и (R - X+) Х.





1. Определить ФЗ для полученных отношений.

- .Проекция ФЗ из F=все подпоследовательности, которые содержат только атрибуты X+ или (R - X+) Х.

Пример.

Drinkers (name, addr, beersLiked, manf, favoriteBeer)

F=

1. name -&gt; addr

2. name -&gt; favoriteBeer

3. beersLiked  -&gt; manf

name –&gt; addr нарушаетНФБК.

- .Построим: name+=name addr favoriteBeer.

- .Разобьем исходное отношение на 2 отношения:

Drinkers1(name, addr, favoriteBeer)

Drinkers2(name, beersLiked, manf)

- .Построим проекции ФЗ (пропустив то, что не содержит ничего нового):

- .Для Drinkers1: name -&gt; addr и name -&gt; favoriteBeer.
- .Для Drinkers2: beersLiked -&gt; manf.

- .Нарушается ли НФБК?

- .Для Drinkers1: name - ключ и все левые стороны ФЗ - суперключи.
- .Для Drinkers2: {name, favoriteBeer} - ключ и beerLiked -&gt; manf нарушает НФБК.

Разобьем Drinkers2

- .Построим: beersLiked+= beersLiked manf.
- .Разобъем:

Drinkers3 (beersLiked, manf)

Drinkers4 (name, beersLiked)

- .В результате все построенные отношения представлены в НФБК:

Drinkers1 (name, addr, favoriteBeer)

Drinkers3 (beersLiked, manf)

Drinkers4 (name, beersLiked)

Третья нормальная форма (3НФ).

Иногда встречаются схемы БД и их ФЗ, для которых дальнейшая декомпозиция нежелательна, хотя схема и не находится в НФБК:

- .Если выполняется разбиение (декомпозиция), невозможно проверить ФЗ в полученных отношениях.
- .Если не выполняется разбиение (декомпозиция), нарушается НФБК.

В общем случае: AB -&gt; C и C -&gt; B.

- .В книге: названиеФильма город -&gt; кинотеатр и  кинотеатр -&gt; город.
- .Другой пример: город улица  -&gt; почтовыйИндекс и почтовыйИндекс -&gt; город.

Ключи: {A; B} и {A; C}, но C -&gt; B имеет слева не суперключ.

- .Предлагается выполнить декомпозицию на BC и AC.

- .Нельзя проверить ФЗ AB -&gt; C в этих отношениях.

Пример.

A = улица, B = город, C = почтовыйИндекс.

улица               почтовыйИндекс

545 Tech Sq.    02138

545 Tech Sq.    02139



город               почтовыйИндекс

Cambridge       02138

Cambridge       02139



Соединение:



город            улица                 почтовыйИндекс

Cambridge   545    Tech Sq.      02138

Cambridge   545    Tech Sq.      02139



&quot;Элегантное&quot; решение проблемы.

Ослабим требование к нормальной форме:

- .Отношение R находится в 3НФ, если для каждой нетривиальной ФЗ X -&gt; A, выполняется:

1. X - суперключ, или

2. А - prime = элемент, по крайней мере, одного ключа.

- .Таким образом: не надо выполнять разбиение (декомпозицию), если все атрибуты являются prime.

Что дает 3НФ?

Существует два важных требования к декомпозиции:

1. Восстановление исходных данных из результатов разбиения (декомпозиции).

- .Восстановление – это проекция и соединение. Это будет обсуждаться в разделе реляционная алгебра.

1. Проверка того, что ФЗ исходного отношения удовлетворяются, путем проверки ФЗ отношений, полученных в результате разбиения.

- .Без доказательства: возможно путем разбиения (декомпозиции) получить НФБК и удовлетворить (1).
- .Без доказательства: возможно путем разбиения (декомпозиции) получить 3НФ и удовлетворить (1) и (2).
- .Невозможно путем разбиения (декомпозиции) получить НФБК и удовлетворить (1) и (2).

- .Пример: Улица-город-почтовый индекс.

Многозначные зависимости.

Многозначная зависимость  X -&gt;-&gt; Y имеет место в отношении R, если для любой пары кортежей с одинаковыми значениями атрибутров из X, другая пара, полученная из первой взаимозаменой атрибутов из Y, также принадлежит R (  из {x1,y1,z1}, {x2,y2,z2} принадлежат  R

следует, что {x1,y2,z1},{x2,y1,z2} также принадлежат  R ).

             X                                        Y                               Другие













### Пример.

Посетители (name, addr, телефоны, favoriteBeer) с МЗЗ name -&gt;-&gt; телефоны. Если Drinkers имеет два кортежа:





name   addr    phones     favoriteBeer

sue       a         p1              b1

sue       a         p2              b2

то это отношение должно иметь еще два таких же кортежа, но в которых телефоны меняются местами:





name    addr    phones     favoriteBeer

sue        a           p2            b1

sue        a           p1            b2



- .Замечание: это условие надо проверить для всех пар кортежей, имеющих одинаковое n



Правила МЗЗ.

1. Каждая ФЗ –является МЗЗ.

- .Потому что, если X -&gt; Y, и поменять местами значения Y в кортежах с одинаковыми значениями  X, то не будут образованы новые кортежи.

- .Пример, в Drinkers: name -&gt;-&gt; addr.

2. Дополнение: если X -&gt;-&gt; Y, то X -&gt;-&gt; Z, где Z - все атрибуты не входящие в X или Y.

- .Т.к. name -&gt;-&gt; phones, то name -&gt;-&gt; addr favoriteBeer.

Расщепление правой части МЗЗ невозможно.

В отличии от обычной ФЗ иногда необходимо иметь несколько атрибутов в правой части МЗЗ. Например:

Drinkers (name, кодгорода, телефоны, favoriteBeer, manf)





name     areaCode     phones       favoriteBeer         manf

Sue        650              555-1111    Bud                      A.B.

Sue        650              555-1111    WickedAle           Pete&#39;s

Sue        415              555-9999    Bud                      A.B.

Sue        415              555-9999    WickedAle           Pete&#39;s



- .name -&gt;-&gt; areaCodephones имеет место, а

name -&gt;-&gt; areaCode  или  name -&gt;-&gt; phones - нет.







Четвертая нормальная форма (4НФ).

Устранение избыточности  с использованием МЗЗ.

- .Приблизительно: обращаться с МЗЗ также как с ФЗ при декомпозиции ФЗ, но не для определения ключей.
- .Определение: R находится в Четвертой Нормальной Форме, если для любой нетривиальной МЗЗ X -&gt;-&gt; Y  (т.е. Y не является подмножеством X, и X Y - не все атрибуты) X - суперключ.

- .Помните что,  X -&gt; Y подразумевает X -&gt;-&gt; Y, поэтому 4НФ более строгая чем НФБК.

- .Выполнить разбиение (декомпозицию) R, используя нарушение 4НФ X -&gt;-&gt; Y, на XY и X (R-Y).







**Пример****.**

Drinkers (name, addr, phones, favoriteBeer)

- .ФЗ: name -&gt; addr
- .Нетривиальные МЗЗ: name -&gt;-&gt; phones и

name -&gt;-&gt; favoriteBeer.

- .Ключ: {name, phones, favoriteBeer}
- .Все три зависимости нарушают 4НФ.
- .Выполнение декомпозиции приведет к отношениям в 4НФ:

Drinkers1(name, addr)

Drinkers2(name, телефоны)

Drinkers3(name, favoriteBeer)
